<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Bug.Vs.Android</title>
  <link href="https://fonts.googleapis.com/css?family=Titillium+Web&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Righteous|Titillium+Web&display=swap" rel="stylesheet">
   <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- FontAwesome Icons-->
<!--     <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
      integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="fontawesome/all.min.css">  
    <link rel="stylesheet" href="css/styles.css"> 
      
   
</head>
<body>  
  <div id="playingField" data-game="shot">
    <div id="rowOne"></div>
    <div id="rowTwo"></div>
    <div id="rowThree"></div>
    <div id="rowFour"></div>
    <div id="rowFive"></div>

  
   
   
   <div id="android" class="fab fa-android"></div>
   
  <div id="arrowLeft" class="fas fa-arrow-alt-circle-left"></div>
  <div id="arrowRight" class="fas fa-arrow-alt-circle-right"></div>
  </div>
  
  <div class="container">
    <button type="button" class="btn btn-danger btn-lg" data-game="play">Play</button>
    <button type="button" class="btn btn-warning btn-lg" data-game="shot">Shot</button>
    <button type="button" class="btn btn-warning btn-lg" data-game="pause">Pause</button>
  </div>
  

  

  
  <script type="text/javascript"> 

  ;(function (){

    var playingField = document.getElementById('playingField'),
        rowOne = document.getElementById('rowOne'),
        rowTwo = document.getElementById('rowTwo'),
        rowThree = document.getElementById('rowThree'),
        rowFour = document.getElementById('rowFour'),
        rowFive = document.getElementById('rowFive'),        
        android = document.getElementById('android');
    
    var goPlay = true;
    
    var clipBullets = [];
  

     function RandomBugName (bug){
        let selectClass = [
          'fas fa-bug bugOrdinary',
          'fas fa-spider bugOrdinary bugArmored',
          'fal fa-bug bugOrdinary bugArmoredManyFaces',//оборотень бронерованный        
          'far fa-bug bugOrdinary bugManyFaces',//оборотень обычный
          'fad fa-bug bugOrdinary bugRowDown',//опускают ряд на 10px
        ]; 
        let randomClass = selectClass[Math.floor(Math.random()*selectClass.length)];
        bug.classList = randomClass; 
     };
     function BugNoArmored (bug) {
        bug.classList = 'fal fa-bug bugOrdinary bugArmoredManyFaces';
        // bug.classList.remove('bugArmoredManyFaces');

     };   


      var selectClass = [
        'fas fa-bug bugOrdinary',
        'fas fa-spider bugOrdinary bugArmored',//бронерованный
        'fal fa-bug bugOrdinary bugArmoredManyFaces',//оборотень бронерованный        
        'far fa-bug bugOrdinary bugManyFaces',//оборотень обычный
        'fad fa-bug bugOrdinary bugRowDown',//опускают ряд на 10px
        'fad fa-spider bugOrdinary bugRowDown2',//опускают ряд на 20px
    ]; 
   
   var randomClass = selectClass[Math.floor(Math.random()*selectClass.length)];

    function createBugs() {
        for(let i = 1; i<=10; i++){
           el = document.createElement('i');
           el.classList = 'fas fa-spider bugOrdinary bugArmored';
           el.style.left = 195 + (65 * i) + 'px';
           el.style.top = '0';
           rowOne.appendChild(el);          
        } 
        for(let i = 1; i<=10; i++){
           el = document.createElement('i');
           el.classList = 'fas fa-bug bugOrdinary';
           el.style.left = 195 + (65 * i) + 'px';
           el.style.top = '0';
           rowTwo.appendChild(el);           
        } 
        for(let i = 1; i<=10; i++){
           el = document.createElement('i');
           el.classList = 'fad fa-bug bugOrdinary bugRowDown';
           el.style.left = 195 + (65 * i) + 'px';
           el.style.top = '0';
           rowThree.appendChild(el);           
        }
        for(let i = 1; i<=10; i++){
           el = document.createElement('i');
           el.classList = 'fas fa-spider bugOrdinary bugArmored';
           el.style.left = 195 + (65 * i) + 'px';
           el.style.top = '0';
           rowFour.appendChild(el);           
        }
        for(let i = 1; i<=10; i++){
           el = document.createElement('i');
           el.classList = 'far fa-bug bugOrdinary bugManyFaces';
           el.style.left = 195 + (65 * i) + 'px';
           el.style.top = '0';
           rowFive.appendChild(el);           
        }                                           
      }; 
      createBugs();



      var rowOneBugs = rowOne.querySelectorAll('i'),
          rowTwoBugs = rowTwo.querySelectorAll('i'),
          rowThreeBugs = rowThree.querySelectorAll('i'),
          rowFourBugs = rowFour.querySelectorAll('i'),
          rowFiveBugs = rowFive.querySelectorAll('i');
     
          // rowOneBugs[0].classList = randomClass;
          // rowOneBugs[1].classList = 'fas fa-bug bugOrdinary';
          // rowOneBugs[2].classList = randomClass;
          // rowOneBugs[3].classList = 'fas fa-bug bugOrdinary';
          // rowOneBugs[4].classList = randomClass;
          // rowOneBugs[5].classList = 'fas fa-bug bugOrdinary';
          // rowOneBugs[6].classList = 'fas fa-bug bugOrdinary';
          // rowOneBugs[7].classList = randomClass;
          // rowOneBugs[8].classList = 'fas fa-bug bugOrdinary';
          // rowOneBugs[9].classList = randomClass;
          // rowOneBugs[10].classList = randomClass;
                   
      
      
  
     
    var step = 10;

    var offsetXBug0 = rowOneBugs[0].offsetLeft,
        offsetXBug1 = rowOneBugs[1].offsetLeft,
        offsetXBug2 = rowOneBugs[2].offsetLeft,
        offsetXBug3 = rowOneBugs[3].offsetLeft,
        offsetXBug4 = rowOneBugs[4].offsetLeft,
        offsetXBug5 = rowOneBugs[5].offsetLeft,
        offsetXBug6 = rowOneBugs[6].offsetLeft,
        offsetXBug7 = rowOneBugs[7].offsetLeft,
        offsetXBug8 = rowOneBugs[8].offsetLeft,
        offsetXBug9 = rowOneBugs[9].offsetLeft;
        

    var offsetXBug10 = rowTwoBugs[0].offsetLeft,
        offsetXBug11 = rowTwoBugs[1].offsetLeft,
        offsetXBug12 = rowTwoBugs[2].offsetLeft,
        offsetXBug13 = rowTwoBugs[3].offsetLeft,
        offsetXBug14 = rowTwoBugs[4].offsetLeft,
        offsetXBug15 = rowTwoBugs[5].offsetLeft,
        offsetXBug16 = rowTwoBugs[6].offsetLeft,
        offsetXBug17 = rowTwoBugs[7].offsetLeft,
        offsetXBug18 = rowTwoBugs[8].offsetLeft,
        offsetXBug19 = rowTwoBugs[9].offsetLeft;

    var offsetXBug20 = rowThreeBugs[0].offsetLeft,
        offsetXBug21 = rowThreeBugs[1].offsetLeft,
        offsetXBug22 = rowThreeBugs[2].offsetLeft,
        offsetXBug23 = rowThreeBugs[3].offsetLeft,
        offsetXBug24 = rowThreeBugs[4].offsetLeft,
        offsetXBug25 = rowThreeBugs[5].offsetLeft,
        offsetXBug26 = rowThreeBugs[6].offsetLeft,
        offsetXBug27 = rowThreeBugs[7].offsetLeft,
        offsetXBug28 = rowThreeBugs[8].offsetLeft,
        offsetXBug29 = rowThreeBugs[9].offsetLeft;

    var offsetXBug30 = rowFourBugs[0].offsetLeft,
        offsetXBug31 = rowFourBugs[1].offsetLeft,
        offsetXBug32 = rowFourBugs[2].offsetLeft,
        offsetXBug33 = rowFourBugs[3].offsetLeft,
        offsetXBug34 = rowFourBugs[4].offsetLeft,
        offsetXBug35 = rowFourBugs[5].offsetLeft,
        offsetXBug36 = rowFourBugs[6].offsetLeft,
        offsetXBug37 = rowFourBugs[7].offsetLeft,
        offsetXBug38 = rowFourBugs[8].offsetLeft,
        offsetXBug39 = rowFourBugs[9].offsetLeft;

    var offsetXBug40 = rowFiveBugs[0].offsetLeft,
        offsetXBug41 = rowFiveBugs[1].offsetLeft,
        offsetXBug42 = rowFiveBugs[2].offsetLeft,
        offsetXBug43 = rowFiveBugs[3].offsetLeft,
        offsetXBug44 = rowFiveBugs[4].offsetLeft,
        offsetXBug45 = rowFiveBugs[5].offsetLeft,
        offsetXBug46 = rowFiveBugs[6].offsetLeft,
        offsetXBug47 = rowFiveBugs[7].offsetLeft,
        offsetXBug48 = rowFiveBugs[8].offsetLeft,
        offsetXBug49 = rowFiveBugs[9].offsetLeft;            
    
    var offsetBullet = playingField.offsetTop;    
      
    
    var direction1 = 1,
        direction2 = 1,
        direction3 = 1,
        direction4 = 1,
        direction5 = -1;

    var directionBullet = 1;  
    var stepAndroid = 10;
    var speedBullet = 5;
    var speedBul = 6;

    var bulletBottomStartPos;
    

      document.addEventListener('keydown', function(event){  
        let offsetAndroid = android.offsetLeft;
         
        if (event.key == 'ArrowLeft'){
          android.style.left = (offsetAndroid - stepAndroid) + 'px';
          arrowRight.style.color = '';
          arrowLeft.style.color = 'rgb(48, 209, 88)';
        }
        else if (event.key == 'ArrowRight'){
          android.style.left =  (offsetAndroid + stepAndroid) + 'px';
          arrowLeft.style.color = '';
          arrowRight.style.color = 'rgb(48, 209, 88)';
        }

        if(android.offsetLeft < 40){
              android.style.left =  (offsetAndroid + stepAndroid) - 10 + 'px';
              arrowLeft.style.color = 'rgb(255, 69, 58)';
        }
        if (playingField.offsetWidth < (android.offsetLeft + android.offsetWidth - 70)) {
              android.style.left = (offsetAndroid - stepAndroid) + 10 + 'px';
              arrowRight.style.color = 'rgb(255, 69, 58)';
        }
        
 
      });

    document.addEventListener('keyup', function(event){         
         
        if (event.key == 'ArrowLeft'){
            arrowLeft.style.color = '';         
                 
        }
       if (event.key == 'ArrowRight'){          
            arrowRight.style.color = '';        
        }        
 
      });  

      //Game Play
    document.addEventListener('click', function (event){
      let target = event.target.dataset.game;
      if(!target) return;
      

      switch (target) {
         case 'play':          
               goPlay = false;                   
            break;
         case 'shot':              
               createBullet ();               
            break; 
         case 'pause':
               goPlay = true;              
            break;        
      };
    });

    function createBullet () {
      let bullet = document.createElement('div');      
      bullet.classList = 'bullet fab fa-ubuntu';            
      bullet.style.left = (android.offsetLeft  - 25) + 'px';
      playingField.append(bullet); 
      clipBullets.push({bullet: bullet, pos: bullet.offsetTop, newPos: bullet.offsetTop});      
   };
   
   

   // подсчет длинны гипотенузы по теореме Пифагора
  function _distance(a, b) {
    return Math.sqrt(
      Math.pow(Math.abs(a.left - b.left), 2) + 
      Math.pow(Math.abs(a.top  - b.top ), 2)
    );
  }

  function collision(el,bul) {
 
      el.getBoundingClientRect();
      bul.getBoundingClientRect(); 

  var radius1 = (el.offsetHeight / 2);
  var radius2 = (bul.offsetHeight / 2);
  
  // растояние между центрами обьектов
  var distance = _distance(
    _center(el), 
    _center(bul)
  );
   
   if (distance < (radius1 + radius2)) {
    // alert('Столкновение! Спасайтесь кто может!');
      var classCheck = el.className; 

      switch (classCheck) {
         case 'fas fa-spider bugOrdinary bugArmored':          
               el.classList.remove('bugArmored')
               bul.remove();

            break;
         case 'far fa-bug bugOrdinary bugManyFaces':
               RandomBugName (el);
               bul.remove();              
            break; 
         case 'fad fa-bug bugOrdinary bugRowDown':
               rowOne.style.top = (rowOne.offsetTop + 10) + 'px';
               rowTwo.style.top = (rowTwo.offsetTop + 10) + 'px';
               rowThree.style.top = (rowThree.offsetTop + 10) + 'px';
               rowFour.style.top = (rowFour.offsetTop + 10) + 'px';
               rowFive.style.top = (rowFive.offsetTop + 10) + 'px';
               el.remove();
               bul.remove();                             
            break;
            default:
               el.remove();
               bul.remove();
            break;        
      };
  }  
  };

  // функция которая вычисляет координаты центра блока
  function _center (el){
  var rect = el.getBoundingClientRect();
  
  // координаты относительно документа
  // (pageYOffset и pageXOffset это размер прокрутки, если она есть)
  var y = (rect.top + pageYOffset);
  var x = (rect.left + pageXOffset);

  return {
    top: y + (el.offsetHeight / 2), // y + половина высоты
    left: x + (el.offsetWidth / 2)  // x + половина ширины
    };
  }





    var update = (step) => {      
      
       if(!goPlay){ 
       clipBullets.forEach((o)=>{

        o.bullet.style.bottom = (o.pos - (o.newPos -= 10)) + 'px'
        // o.style.bottom = (o.offsetTop - speedBullet)  + 'px';

          console.log(clipBullets);       
      
      if(o.bullet.offsetTop == -5 || o.bullet.offsetTop == -10){
            o.bullet.remove()
       }
       
        
        playingField.querySelectorAll('i').forEach( el => {          
            collision(el,o.bullet);     
        });
      });
      

      offsetXBug0 += 2 * direction1;
      offsetXBug1 += 2 * direction1;
      offsetXBug2 += 2 * direction1;
      offsetXBug3 += 2 * direction1;
      offsetXBug4 += 2 * direction1;
      offsetXBug5 += 2 * direction1;
      offsetXBug6 += 2 * direction1;
      offsetXBug7 += 2 * direction1;
      offsetXBug8 += 2 * direction1;
      offsetXBug9 += 2 * direction1;
      
      offsetXBug10 -= 2 * direction2;
      offsetXBug11 -= 2 * direction2;
      offsetXBug12 -= 2 * direction2;
      offsetXBug13 -= 2 * direction2;
      offsetXBug14 -= 2 * direction2;
      offsetXBug15 -= 2 * direction2;
      offsetXBug16 -= 2 * direction2;
      offsetXBug17 -= 2 * direction2;
      offsetXBug18 -= 2 * direction2;
      offsetXBug19 -= 2 * direction2;

      offsetXBug20 += 2 * direction3;
      offsetXBug21 += 2 * direction3;
      offsetXBug22 += 2 * direction3;
      offsetXBug23 += 2 * direction3;
      offsetXBug24 += 2 * direction3;
      offsetXBug25 += 2 * direction3;
      offsetXBug26 += 2 * direction3;
      offsetXBug27 += 2 * direction3;
      offsetXBug28 += 2 * direction3;
      offsetXBug29 += 2 * direction3;

      offsetXBug30 -= 2 * direction4;
      offsetXBug31 -= 2 * direction4;
      offsetXBug32 -= 2 * direction4;
      offsetXBug33 -= 2 * direction4;
      offsetXBug34 -= 2 * direction4;
      offsetXBug35 -= 2 * direction4;
      offsetXBug36 -= 2 * direction4;
      offsetXBug37 -= 2 * direction4;
      offsetXBug38 -= 2 * direction4;
      offsetXBug39 -= 2 * direction4;

      offsetXBug40 -= 2 * direction5;
      offsetXBug41 -= 2 * direction5;
      offsetXBug42 -= 2 * direction5;
      offsetXBug43 -= 2 * direction5;
      offsetXBug44 -= 2 * direction5;
      offsetXBug45 -= 2 * direction5;
      offsetXBug46 -= 2 * direction5;
      offsetXBug47 -= 2 * direction5;
      offsetXBug48 -= 2 * direction5;
      offsetXBug49 -= 2 * direction5;     

     
      speedBullet -= 16 * directionBullet;
      speedBul-= 6 * directionBullet;

    //rowOneBugs
      rowOneBugs.forEach( (el) => {
            if (playingField.offsetWidth <= (el.offsetLeft + el.offsetWidth)){
                 direction1 = -1;                
            } 
            if(el.offsetLeft <-1){
                 direction1 = 1;                
            }         
        });
    //rowTwoBugs
      rowTwoBugs.forEach( (el) => {
            if(el.offsetLeft <-1){
                 direction2 = -1;
            } 
            if(playingField.offsetWidth <= (el.offsetLeft + el.offsetWidth)){
                 direction2 = 1;
            }        
        });
      //rowThreeBugs
        rowThreeBugs.forEach( (el) => {
            if (playingField.offsetWidth <= (el.offsetLeft + el.offsetWidth)){
                 direction3 = -1;                
            } 
            if(el.offsetLeft <-1){
                 direction3 = 1;                
            }         
        });
      //rowFourBugs
      rowFourBugs.forEach( (el) => {
            if(el.offsetLeft <-1){
                 direction4 = -1;
            } 
            if(playingField.offsetWidth <= (el.offsetLeft + el.offsetWidth)){
                 direction4 = 1;
            }        
        });
      //rowFiveBugs
        rowFiveBugs.forEach( (el) => {
            if (playingField.offsetWidth <= (el.offsetLeft + el.offsetWidth)) {
                 direction5 = 1;                
            } 
            if(el.offsetLeft <-1){             
                 direction5 = -1;                
            }         
        });
      };
    };
   

    var render = () => {
      rowOneBugs[0].style.left = offsetXBug0 + 'px';
      rowOneBugs[1].style.left = offsetXBug1 + 'px';
      rowOneBugs[2].style.left = offsetXBug2 + 'px';
      rowOneBugs[3].style.left = offsetXBug3 + 'px';
      rowOneBugs[4].style.left = offsetXBug4 + 'px';
      rowOneBugs[5].style.left = offsetXBug5 + 'px';
      rowOneBugs[6].style.left = offsetXBug6 + 'px';
      rowOneBugs[7].style.left = offsetXBug7 + 'px';
      rowOneBugs[8].style.left = offsetXBug8 + 'px';
      rowOneBugs[9].style.left = offsetXBug9 + 'px';

      rowTwoBugs[0].style.left = offsetXBug10 + 'px';
      rowTwoBugs[1].style.left = offsetXBug11 + 'px';
      rowTwoBugs[2].style.left = offsetXBug12 + 'px';
      rowTwoBugs[3].style.left = offsetXBug13 + 'px';
      rowTwoBugs[4].style.left = offsetXBug14 + 'px';
      rowTwoBugs[5].style.left = offsetXBug15 + 'px';
      rowTwoBugs[6].style.left = offsetXBug16 + 'px';
      rowTwoBugs[7].style.left = offsetXBug17 + 'px';
      rowTwoBugs[8].style.left = offsetXBug18 + 'px';
      rowTwoBugs[9].style.left = offsetXBug19 + 'px';

      rowThreeBugs[0].style.left = offsetXBug20 + 'px';
      rowThreeBugs[1].style.left = offsetXBug21 + 'px';
      rowThreeBugs[2].style.left = offsetXBug22 + 'px';
      rowThreeBugs[3].style.left = offsetXBug23 + 'px';
      rowThreeBugs[4].style.left = offsetXBug24 + 'px';
      rowThreeBugs[5].style.left = offsetXBug25 + 'px';
      rowThreeBugs[6].style.left = offsetXBug26 + 'px';
      rowThreeBugs[7].style.left = offsetXBug27 + 'px';
      rowThreeBugs[8].style.left = offsetXBug28 + 'px';
      rowThreeBugs[9].style.left = offsetXBug29 + 'px';

      rowFourBugs[0].style.left = offsetXBug30 + 'px';
      rowFourBugs[1].style.left = offsetXBug31 + 'px';
      rowFourBugs[2].style.left = offsetXBug32 + 'px';
      rowFourBugs[3].style.left = offsetXBug33 + 'px';
      rowFourBugs[4].style.left = offsetXBug34 + 'px';
      rowFourBugs[5].style.left = offsetXBug35 + 'px';
      rowFourBugs[6].style.left = offsetXBug36 + 'px';
      rowFourBugs[7].style.left = offsetXBug37 + 'px';
      rowFourBugs[8].style.left = offsetXBug38 + 'px';
      rowFourBugs[9].style.left = offsetXBug39 + 'px';

      rowFiveBugs[0].style.left = offsetXBug40 + 'px';
      rowFiveBugs[1].style.left = offsetXBug41 + 'px';
      rowFiveBugs[2].style.left = offsetXBug42 + 'px';
      rowFiveBugs[3].style.left = offsetXBug43 + 'px';
      rowFiveBugs[4].style.left = offsetXBug44 + 'px';
      rowFiveBugs[5].style.left = offsetXBug45 + 'px';
      rowFiveBugs[6].style.left = offsetXBug46 + 'px';
      rowFiveBugs[7].style.left = offsetXBug47 + 'px';
      rowFiveBugs[8].style.left = offsetXBug48 + 'px';
      rowFiveBugs[9].style.left = offsetXBug49 + 'px';
    };

   // переопределить requestAnimationFrame, чтобы эмулировать различное количество FPS (одинаково во всех примерах игрового цикла)
    window.requestAnimationFrame = (func) => {
      clearTimeout(window.rafTimer);
      window.rafTimer = setTimeout(func, 1000 / (window.maxFPS || 60));
    };

    // game loop
    var last = performance.now(),
        step = 1 / 60, // обновление должно вызываться 60 раз в секунду
        dt = 0,
        now;

    var frame = () => {
      now = performance.now();
      dt += (now - last) / 1000;
      while(dt > step) {
        dt = dt - step;
        update(step);
      }
      last = now;

      render();
      requestAnimationFrame(frame); 
    }
      
      requestAnimationFrame(frame); 

  }());
 
  
            
      
  </script>


</body>
</html>