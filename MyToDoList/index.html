<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="shortcut icon" href="icon.png" type="image/png">
    <title>MyToDoList</title>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- FontAwesome Icons-->
   <link rel="stylesheet" href="fontawesome/all.min.css">  
   <link rel="stylesheet" href="css/styles.css">  
</head>
<body>
    <div class="container wrapper">
      <h1>To do list (localStorage)</h1>    
      <form action="javascript:void(0)" id="toDoList">
        <input type="text" name="asktask" placeholder="..." class="form-control input" autocomplete="off">
        <button type="submit" class="btn btn-primary btn-lg btn-block button-add">Add list</button>
      </form>
      <div id="container"></div>
      <button type="button" id="btnAllDel" class="btn btn-danger btn-lg d-flex ml-auto">All Delete</button>
    </div>

<script>
  window.addEventListener('load', function() {
    ;(function () {      

        let toDoList = _('#toDoList')[0],
            allDel = _('#btnAllDel')[0],
            container = _('#container')[0];         
           

        let tasks = JSON.parse(localStorage.getItem('todo')) || [], 
            lastId = tasks.length; 

        function addItem(task) {                            
            container.insertAdjacentHTML('beforeEnd', [
              `<p class="list d-flex" data-id="${task.id}" tabindex="1">
                <span class="list-num">${task.id + 1}</span>
                <span class="list-text">${task.text}</span>              
                <button type="button" class="remove fal fa-trash-alt" title="Remove?" data-click="remove" tabindex="2"></button>
              </p>`
            ].join('') );
        };  

        tasks.forEach( (task) =>{
        addItem(task);
      });

      function createTask () {        

        let task = {
           
            id: lastId++,
            text: toDoList.asktask.value,
            created: new Date()
        };

        tasks.push(task);
        localStorage.setItem('todo', JSON.stringify(tasks));

        addItem(task);    
      };  


      toDoList.asktask.onfocus = (()=>{        
        toDoList.asktask.classList.remove('invalid-task');
      });     

      toDoList.addEventListener('submit', function (event){
      
        event.preventDefault();

        if(toDoList.asktask.value == ''){ 

          toDoList.asktask.classList.add('invalid-task');              
          
        }else{           

              createTask ();
              toDoList.reset(); 
        };     
      });

      allDel.addEventListener('click', () =>{ 

        localStorage.clear();
          
          let listsDel = _('.list');

          for (let i = 0; i < listsDel.length; i++) {
                listsDel[i].remove();
          };
            window.location.reload();       
      }); 

      container.addEventListener('click', function(e){

        let el = e.target;

        if (el.matches('[data-click="remove"]')) {
          let parent = el.closest('[data-id]');

          for (let i in tasks) {
            if (tasks[i].id == parent.dataset.id) {
              tasks.splice(i, 1);
              localStorage.setItem('todo', JSON.stringify(tasks));
              break;
            };
          };

          parent.remove();
        }
      });

           
      function _(selector) {
        return document.querySelectorAll(selector);
      };  

    }());
  });  
</script>
</body>

</html>