<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>tab</title>
  <link href="https://fonts.googleapis.com/css?family=Titillium+Web&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Righteous|Titillium+Web&display=swap" rel="stylesheet">
   <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- FontAwesome Icons-->
<!--     <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
      integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="fontawesome/all.min.css">  
    <link rel="stylesheet" href="css/styles.css"> 
      
   
</head>
<body>  
  <div id="playingField" data-game="shot">
    <div id="rowOne">
     <!--  <i class="fal fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i> -->
    </div>

    <!-- <div id="levelTwo">
      <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
    </div>

    <div id="levelThree">
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
     <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-bug bugActive"></i>
    </div> 

    <div id="levelFour">
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
    </div>

    <div id="levelFive">
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
    </div>    -->
   
   
   <div id="android" class="fab fa-android"></div>
   
  <div id="arrowLeft" class="fas fa-arrow-alt-circle-left"></div>
  <div id="arrowRight" class="fas fa-arrow-alt-circle-right"></div>
  </div>
  
  <div class="container">
    <button type="button" class="btn btn-danger btn-lg" data-game="play">Play</button>
    <button type="button" class="btn btn-warning btn-lg" data-game="shot">Shot</button>
    <button type="button" class="btn btn-warning btn-lg" data-game="pause">Pause</button>
  </div>
  

  

  
  <script type="text/javascript"> 

  ;(function (){


    var playingField = document.getElementById('playingField');
    // var rowOne = document.getElementById('rowOne');
    

    // var levelTwo = document.getElementById('levelTwo');
    // var levelThree = document.getElementById('levelThree');
    // var levelFour = document.getElementById('levelFour');
    // var levelFive = document.getElementById('levelFive');    
    var android = document.getElementById('android');
    // var bugActive = document.querySelectorAll('.bugActive');
    
    var clipBullets = [];
    var bugArray = []
    var goPlay = true;
    var bugLive = true;
     var bugs = [];

     function RandomBugName (bug){
        let selectClass = [
          'fas fa-bug bugOrdinary',
          'fas fa-spider bugOrdinary bugArmored',
          'fal fa-bug bugOrdinary bugArmoredManyFaces',//оборотень бронерованный        
          'far fa-bug bugOrdinary bugManyFaces',//оборотень обычный
          'fad fa-bug bugOrdinary bugOrdinary',//опускают ряд на 10px
        ]; 
        let randomClass = selectClass[Math.floor(Math.random()*selectClass.length)];
        bug.classList = randomClass; 
     };
     function BugNoArmored (bug) {
        bug.classList = 'fal fa-bug bugOrdinary bugArmoredManyFaces';
        // bug.classList.remove('bugArmoredManyFaces');

     };
     function BugRemove (bug) {       
        bug.remove();      
       if(!bugLive) return false;
        // bug.classList.remove('bugArmoredManyFaces');
     };

      // function notDead() {                 
      //   bugLive = false;
      // }     


      var selectClass = [
        'fas fa-bug bugOrdinary',
        'fas fa-spider bugOrdinary bugArmored',//бронерованный
        'fal fa-bug bugOrdinary bugArmoredManyFaces',//оборотень бронерованный        
        'far fa-bug bugOrdinary bugManyFaces',//оборотень обычный
        'fad fa-bug bugOrdinary bugRowDown',//опускают ряд на 10px
        'fad fa-spider bugOrdinary bugRowDown2',//опускают ряд на 20px
    ]; 
   
   var randomClass = selectClass[Math.floor(Math.random()*selectClass.length)]; 


    function createBugs() {
        for(let i = 1; i<=11; i++){
           el = document.createElement('i');
           el.classList = 'fas fa-spider bugOrdinary bugArmored';
           el.style.left = 200 + (60 * i) + 'px';
           el.style.top = '50px';
           playingField.appendChild(el);
           bugs.push({el});
        } 
        for(let i = 1; i<=11; i++){
           el = document.createElement('i');
           el.classList = 'fas fa-bug bugOrdinary';
           el.style.left = 200 + (60 * i) + 'px';
           el.style.top = '120px';
           playingField.appendChild(el);           
        }                                           
      }; 
      createBugs();



      var rowOneBugs = playingField.querySelectorAll('i');
          // rowOneBugs[0].classList = randomClass;
          // rowOneBugs[1].classList = 'fas fa-bug bugOrdinary';
          // rowOneBugs[2].classList = randomClass;
          // rowOneBugs[3].classList = 'fas fa-bug bugOrdinary';
          // rowOneBugs[4].classList = randomClass;
          // rowOneBugs[5].classList = 'fas fa-bug bugOrdinary';
          // rowOneBugs[6].classList = 'fas fa-bug bugOrdinary';
          // rowOneBugs[7].classList = randomClass;
          // rowOneBugs[8].classList = 'fas fa-bug bugOrdinary';
          // rowOneBugs[9].classList = randomClass;
          // rowOneBugs[10].classList = randomClass;
                   
      console.log(bugArray)
      
  
     
    var step = 10;
    // console.log(levelThree.offsetTop + levelThree.offsetHeight)
      
      
    
    var offsetXBug0 = rowOneBugs[0].offsetLeft,
        offsetXBug1 = rowOneBugs[1].offsetLeft,
        offsetXBug2 = rowOneBugs[2].offsetLeft,
        offsetXBug3 = rowOneBugs[3].offsetLeft,
        offsetXBug4 = rowOneBugs[4].offsetLeft,
        offsetXBug5 = rowOneBugs[5].offsetLeft,
        offsetXBug6 = rowOneBugs[6].offsetLeft,
        offsetXBug7 = rowOneBugs[7].offsetLeft,
        offsetXBug8 = rowOneBugs[8].offsetLeft,
        offsetXBug9 = rowOneBugs[9].offsetLeft,
        offsetXBug10 = rowOneBugs[10].offsetLeft;
    // var offsetX2 = levelTwo.offsetLeft;
    // var offsetX3 = levelThree.offsetLeft;
    // var offsetX4 = levelFour.offsetLeft;
    // var offsetX5 = levelFive.offsetLeft;    
    var offsetBullet = playingField.offsetTop;
    var direction1 = 1;
    // var direction2 = 1;
    // var direction3 = 1;
    // var direction4 = 1;
    // var direction5 = 1;
    var directionBullet = 1;  
    var stepAndroid = 10;
    var speedBullet = 5;
    var speedBul = 6;

    var bulletBottomStartPos;
    
    

      document.addEventListener('keydown', function(event){  
        let offsetAndroid = android.offsetLeft;
         
        if (event.key == 'ArrowLeft'){
          android.style.left = (offsetAndroid - stepAndroid) + 'px';
          arrowRight.style.color = '';
          arrowLeft.style.color = 'rgb(48, 209, 88)';
        }
        else if (event.key == 'ArrowRight'){
          android.style.left =  (offsetAndroid + stepAndroid) + 'px';
          arrowLeft.style.color = '';
          arrowRight.style.color = 'rgb(48, 209, 88)';
        }

        if(android.offsetLeft < 40){
              android.style.left =  (offsetAndroid + stepAndroid) - 10 + 'px';
              arrowLeft.style.color = 'rgb(255, 69, 58)';
        }
        if (playingField.offsetWidth < (android.offsetLeft + android.offsetWidth - 70)) {
              android.style.left = (offsetAndroid - stepAndroid) + 10 + 'px';
              arrowRight.style.color = 'rgb(255, 69, 58)';
        }
        
 
      });

    document.addEventListener('keyup', function(event){         
         
        if (event.key == 'ArrowLeft'){
            arrowLeft.style.color = '';         
                 
        }
       if (event.key == 'ArrowRight'){          
            arrowRight.style.color = '';        
        }        
 
      });  

      //Game Play
    document.addEventListener('click', function (event){
      let target = event.target.dataset.game;
      if(!target) return;
      

      switch (target) {
         case 'play':          
               goPlay = false;                   
            break;
         case 'shot':
               createBullet ();               
            break; 
         case 'pause':
               goPlay = true;              
            break;        
      };
    });

    function createBullet () {
      let bullet = document.createElement('div');      
      bullet.classList = 'bullet fab fa-ubuntu';            
      bullet.style.left = (android.offsetLeft  - 25) + 'px';
      playingField.append(bullet);      
      clipBullets.push({bullet: bullet, pos: bullet.offsetTop, newPos: bullet.offsetTop});
      // bulletBottomStartPos = bullet.offsetTop
   };
   
   

   // подсчет длинны гипотенузы по теореме Пифагора
  function _distance(a, b) {
    return Math.sqrt(
      Math.pow(Math.abs(a.left - b.left), 2) + 
      Math.pow(Math.abs(a.top  - b.top ), 2)
    );
  }

  function collision(el,bul) {
 
      el.getBoundingClientRect();
      bul.getBoundingClientRect(); 

  var radius1 = (el.offsetHeight / 2);
  var radius2 = (bul.offsetHeight / 2);
  
  // растояние между центрами обьектов
  var distance = _distance(
    _center(el), 
    _center(bul)
  );
   
   if (distance < (radius1 + radius2)) {
    // alert('Столкновение! Спасайтесь кто может!');
     if(el.classList == 'fas fa-spider bugOrdinary bugArmored'){ 
        bugLive = false;
        // BugRemove();
        
        setTimeout(el.classList = 'fas fa-spider bugOrdinary', 1000); 
             
        // el.classList = 'fas fa-spider bugOrdinary';


     }
     if(el.classList == 'fad fa-bug bugOrdinary bugRowDown'){
        rowOneBugs.forEach((el)=>{

          el.style.top = (el.offsetTop + 10) + 'px';

        });
     }
     if(el.classList == 'fad fa-spider bugOrdinary bugRowDown2'){
        rowOneBugs.forEach((el)=>{
          el.style.top = (el.offsetTop + 20) + 'px';

        });
     }
     if(el.classList == 'far fa-bug bugOrdinary bugManyFaces'){
        // RandomBugName(el);
        // el.classlist ='fas fa-bug bugOrdinary';

        // el.classList = randomClass;
     }else{
      BugRemove (el);
      bul.remove();
     }
      
     
      
     
     

   
     //  (cloned.offsetLeft + directionBullet) + 'px';
    

     
    
  }  
  
  };

  // функция которая вычисляет координаты центра блока
  function _center (el){
  var rect = el.getBoundingClientRect();
  
  // координаты относительно документа
  // (pageYOffset и pageXOffset это размер прокрутки, если она есть)
  var y = (rect.top + pageYOffset);
  var x = (rect.left + pageXOffset);

  return {
    top: y + (el.offsetHeight / 2), // y + половина высоты
    left: x + (el.offsetWidth / 2)  // x + половина ширины
    };
  }





    var update = (step) => {      
      
       clipBullets.forEach((o)=>{


        // o.style.bottom = (o.offsetTop - speedBullet)  + 'px';

        o.bullet.style.bottom = (o.pos - (o.newPos -= 10)) + 'px'
        console.log(1)         
      
       if(o.newPos < 0){
            o.bullet.remove()
            console.log(123)
            clipBullets.shift(o)
       }
       
        
        playingField.querySelectorAll('i').forEach( el => {
          
              collision(el,o.bullet);        
         
        });
        

      });

      offsetXBug0 += 2 * direction1;
      offsetXBug1 += 2 * direction1;
      offsetXBug2 += 2 * direction1;
      offsetXBug3 += 2 * direction1;
      offsetXBug4 += 2 * direction1;
      offsetXBug5 += 2 * direction1;
      offsetXBug6 += 2 * direction1;
      offsetXBug7 += 2 * direction1;
      offsetXBug8 += 2 * direction1;
      offsetXBug9 += 2 * direction1;
      offsetXBug10 += 2 * direction1;
      // offsetX2 -= 2 * direction2;
      // offsetX3 += 2 * direction3;
      // offsetX4 -= 2 * direction4;
      // offsetX5 += 2 * direction5;
      speedBullet -= 6 * directionBullet;
      speedBul-= 6 * directionBullet;
      playingField.querySelectorAll('i').forEach( (el) => {
            if (playingField.offsetWidth < (el.offsetLeft + el.offsetWidth)) {
                 direction1 = -1;
            } 
            if(el.offsetLeft  == 0 || el.offsetLeft <-1){
                 direction1 = 1;
            }         
         
        });


      //level1 
      // if (playingField.offsetWidth < (levelOne.offsetLeft + levelOne.offsetWidth)) {
      //   direction1 = -1;
      //   }
      // if(levelOne.offsetLeft == 0 || levelOne.offsetLeft <-1){
      //   direction1 = 1;
      // }
      // //Level2
      // if(levelTwo.offsetLeft == 0 || levelTwo.offsetLeft <-1){
      //   direction2 = -1;
      // }
      // if (playingField.offsetWidth < (levelTwo.offsetLeft + levelTwo.offsetWidth)) {
      //   direction2 = 1;
      // }
      // //Level3
      //  if (playingField.offsetWidth < (levelThree.offsetLeft + levelThree.offsetWidth)) {
      //   direction3 = -1;
      //   }
      // if(levelThree.offsetLeft == 0 || levelThree.offsetLeft <-1){
      //   direction3 = 1;
      // }
      //  //Level4
      // if(levelFour.offsetLeft == 0 || levelFour.offsetLeft <-1){
      //   direction4 = -1;
      // }
      // if (playingField.offsetWidth < (levelFour.offsetLeft + levelFour.offsetWidth)) {
      //   direction4 = 1;
      // }
      // //Level5
      //  if (playingField.offsetWidth < (levelFive.offsetLeft + levelFive.offsetWidth)) {
      //   direction5 = -1;
      //   }
      // if(levelFive.offsetLeft == 0 || levelFive.offsetLeft <-1){
      //   direction5 = 1;
      // }
    
      }
   

    var render = () => {
      rowOneBugs[0].style.left = offsetXBug0 + 'px';
      rowOneBugs[1].style.left = offsetXBug1 + 'px';
      rowOneBugs[2].style.left = offsetXBug2 + 'px';
      rowOneBugs[3].style.left = offsetXBug3 + 'px';
      rowOneBugs[4].style.left = offsetXBug4 + 'px';
      rowOneBugs[5].style.left = offsetXBug5 + 'px';
      rowOneBugs[6].style.left = offsetXBug6 + 'px';
      rowOneBugs[7].style.left = offsetXBug7 + 'px';
      rowOneBugs[8].style.left = offsetXBug8 + 'px';
      rowOneBugs[9].style.left = offsetXBug9 + 'px';
      rowOneBugs[10].style.left = offsetXBug10 + 'px';

      
      // rowOneBugs[0].style.left = offsetX1 + 'px'; 
      // playingField.querySelectorAll('.bugActive').forEach( (el,i) => {
      //         el.style.left = offsetX1 + (60 * i) + 'px';         
         
      //   });
      
     
      // levelOne.style.left = offsetX1 + 'px';
      // levelTwo.style.left = offsetX2 + 'px';
      // levelThree.style.left = offsetX3 + 'px';
      // levelFour.style.left = offsetX4 + 'px';
      // levelFive.style.left = offsetX5 + 'px';           
    };

   // переопределить requestAnimationFrame, чтобы эмулировать различное количество FPS (одинаково во всех примерах игрового цикла)
    window.requestAnimationFrame = (func) => {
      clearTimeout(window.rafTimer);
      window.rafTimer = setTimeout(func, 1000 / (window.maxFPS || 60));
    };


    // game loop
    var last = performance.now(),
        step = 1 / 60, // обновление должно вызываться 60 раз в секунду
        dt = 0,
        now;


    var frame = () => {
      now = performance.now();
      dt += (now - last) / 1000;
      while(dt > step) {
        dt = dt - step;
        update(step);
      }
      last = now;

      render();
      requestAnimationFrame(frame); 
    }
      
      requestAnimationFrame(frame); 

  }());
 
  
            
      
  </script>


</body>
</html>