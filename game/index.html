<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>tab</title>
  <link href="https://fonts.googleapis.com/css?family=Titillium+Web&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Righteous|Titillium+Web&display=swap" rel="stylesheet">
   <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- FontAwesome Icons-->
<!--     <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
      integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="fontawesome/all.min.css">  
    <link rel="stylesheet" href="css/styles.css"> 
      
   
</head>
<body>
  <div id="playingField" data-game="shot">
    <div id="levelOne">
      <i class="fal fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
    </div>

    <div id="levelTwo">
      <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
    </div>

    <div id="levelThree">
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
     <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-bug bugActive"></i>
    </div> 

    <div id="levelFour">
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
    </div>

    <div id="levelFive">
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-spider bugActive bugUltra"></i>
      <i class="fas fa-bug bugActive"></i>
      <i class="fas fa-bug bugActive"></i>
    </div>   
   
   <!-- <div class="bullet">
     <i class="fad fa-long-arrow-alt-up ggh"></i>
   </div> -->
   <div id="android" class="fab fa-android"></div>
   
  <div id="arrowLeft" class="fas fa-arrow-alt-circle-left"></div>
  <div id="arrowRight" class="fas fa-arrow-alt-circle-right"></div>
  </div>
  
  <div class="container">
    <button type="button" class="btn btn-danger btn-lg" data-game="play">Play</button>
    <button type="button" class="btn btn-warning btn-lg" data-game="shot">Shot</button>
    <button type="button" class="btn btn-warning btn-lg" data-game="pause">Pause</button>
  </div>
  

  

  
  <script type="text/javascript">

  ;(function (){

    var playingField = document.getElementById('playingField');
    var levelOne = document.getElementById('levelOne');
    var levelTwo = document.getElementById('levelTwo');
    var levelThree = document.getElementById('levelThree');
    var levelFour = document.getElementById('levelFour');
    var levelFive = document.getElementById('levelFive');    
    var android = document.getElementById('android');
    var bugActive = document.querySelectorAll('.bugActive');
    var aboimaBullets = [];
    
     
    var step = 10;
      
      
    
    var offsetX1 = levelOne.offsetLeft;
    var offsetX2 = levelTwo.offsetLeft;
    var offsetX3 = levelThree.offsetLeft;
    var offsetX4 = levelFour.offsetLeft;
    var offsetX5 = levelFive.offsetLeft;    
    var offsetBullet = playingField.offsetTop;
    var direction1 = 1;
    var direction2 = 1;
    var direction3 = 1;
    var direction4 = 1;
    var direction5 = 1;
    var directionBullet = 1;  
    var stepAndroid = 10;
    var speedBullet = 1;

      document.addEventListener('keydown', function(event){  
        let offsetAndroid = android.offsetLeft;
         
        if (event.key == 'ArrowLeft'){
          android.style.left = (offsetAndroid - stepAndroid) + 'px';
          arrowRight.style.color = '';
          arrowLeft.style.color = 'rgb(48, 209, 88)';
        }
        else if (event.key == 'ArrowRight'){
          android.style.left =  (offsetAndroid + stepAndroid) + 'px';
          arrowLeft.style.color = '';
          arrowRight.style.color = 'rgb(48, 209, 88)';
        }

        if(android.offsetLeft < 40){
              android.style.left =  (offsetAndroid + stepAndroid) - 10 + 'px';
              arrowLeft.style.color = 'rgb(255, 69, 58)';
        }
        if (playingField.offsetWidth < (android.offsetLeft + android.offsetWidth - 70)) {
              android.style.left = (offsetAndroid - stepAndroid) + 10 + 'px';
              arrowRight.style.color = 'rgb(255, 69, 58)';
        }
        
 
      });

    document.addEventListener('keyup', function(event){         
         
        if (event.key == 'ArrowLeft'){
            arrowLeft.style.color = '';         
                 
        }
       if (event.key == 'ArrowRight'){          
            arrowRight.style.color = '';        
        }        
 
      });  

      //Game Play
    document.addEventListener('click', function (event){
      let target = event.target.dataset.game;
      if(!target) return;
      

      switch (target) {
         case 'play':          
               requestAnimationFrame(frame);                   
            break;
         case 'shot':
               createBullet ();               
            break; 
         case 'pause':
               myStopFunction()              
            break;        
      };
    });

      function createBullet () {
      var bullet = document.createElement('div');      
      bullet.classList = 'bullet fab fa-ubuntu';            
      bullet.style.left = (android.offsetLeft  - 25) + 'px';
      playingField.append(bullet);
      aboimaBullets.push(bullet);
   };






    var update = (step) => {    
      
       aboimaBullets.forEach((o)=>{ 

        o.style.bottom = (o.offsetTop - speedBullet)  + 'px';
        console.log(o.offsetTop);
        
      
     //level Five check
       if((levelFive.offsetTop+levelFive.offsetHeight) == o.offsetTop){

        levelFive.querySelectorAll('.bugActive').forEach( el => {
        
          if ((levelFive.offsetLeft + el.offsetLeft + el.offsetWidth >= o.offsetLeft) && (levelFive.offsetLeft + el.offsetLeft<= o.offsetLeft + o.offsetWidth)){ 
          if(el.classList=='fas fa-spider bugActive bugUltra'){
            el.classList.remove('bugUltra');
            o.remove();
          }else{        
              o.remove();
              el.remove();
              var cloned = el.cloneNode(true);
              playingField.append(cloned);

              cloned.style.left = (playingField.offsetWidth) + 'px';
              
              // el.remove();
             }     
            }
        });     

      };
 
 //level Four check
      if((levelFour.offsetTop+levelFour.offsetHeight) + 10 == o.offsetTop){    
        
        levelFour.querySelectorAll('.bugActive').forEach( el => {
        
          if ((levelFour.offsetLeft + el.offsetLeft + el.offsetWidth >= o.offsetLeft) && (levelFour.offsetLeft + el.offsetLeft<= o.offsetLeft + o.offsetWidth)){
            // alert()
              o.remove();
              el.remove();                    
            }
        });
      };

  //level Three check    
      if((levelThree.offsetTop+levelThree.offsetHeight) == o.offsetTop){    
        
        levelThree.querySelectorAll('.bugActive').forEach( el => {
        
          if ((levelThree.offsetLeft + el.offsetLeft + el.offsetWidth >= o.offsetLeft) && (levelThree.offsetLeft + el.offsetLeft<= o.offsetLeft + o.offsetWidth)){

              o.remove();
              el.remove();
                    
            }
        });
      };

    //level Two check 
      if((levelTwo.offsetTop+levelTwo.offsetHeight) == o.offsetTop){    
        
        levelTwo.querySelectorAll('.bugActive').forEach( el => {
        
          if ((levelTwo.offsetLeft + el.offsetLeft + el.offsetWidth >= o.offsetLeft) && (levelTwo.offsetLeft + el.offsetLeft<= o.offsetLeft + o.offsetWidth)){
                      
              o.remove();
              el.remove();
                    
            }
        });
      };

    //level One check 
      if((levelOne.offsetTop+levelOne.offsetHeight) + 10 == o.offsetTop){    
        
        levelOne.querySelectorAll('.bugActive').forEach( el => {
        
          if ((levelOne.offsetLeft + el.offsetLeft + el.offsetWidth >= o.offsetLeft) && (levelOne.offsetLeft + el.offsetLeft<= o.offsetLeft + o.offsetWidth)){                 
              o.remove();
              el.remove();
                    
            }
        });
      };  

      });

      // ЕСЛИ Я УВЕЛИЧИВАЮ СКОРОСТЬ ДВИЖЕНИЯ ПУЛИ ЛЕТЯТ МИМО
      offsetX1 += 2 * direction1;
      offsetX2 -= 2 * direction2;
      offsetX3 += 2 * direction3;
      offsetX4 -= 2 * direction4;
      offsetX5 += 2 * direction5;
      speedBullet -= 6 * directionBullet;

      //level1 
      if (playingField.offsetWidth < (levelOne.offsetLeft + levelOne.offsetWidth)) {
        direction1 = -1;
        }
      if(levelOne.offsetLeft == 0 || levelOne.offsetLeft <-1){
        direction1 = 1;
      }
      //Level2
      if(levelTwo.offsetLeft == 0 || levelTwo.offsetLeft <-1){
        direction2 = -1;
      }
      if (playingField.offsetWidth < (levelTwo.offsetLeft + levelTwo.offsetWidth)) {
        direction2 = 1;
      }
      //Level3
       if (playingField.offsetWidth < (levelThree.offsetLeft + levelThree.offsetWidth)) {
        direction3 = -1;
        }
      if(levelThree.offsetLeft == 0 || levelThree.offsetLeft <-1){
        direction3 = 1;
      }
       //Level4
      if(levelFour.offsetLeft == 0 || levelFour.offsetLeft <-1){
        direction4 = -1;
      }
      if (playingField.offsetWidth < (levelFour.offsetLeft + levelFour.offsetWidth)) {
        direction4 = 1;
      }
      //Level5
       if (playingField.offsetWidth < (levelFive.offsetLeft + levelFive.offsetWidth)) {
        direction5 = -1;
        }
      if(levelFive.offsetLeft == 0 || levelFive.offsetLeft <-1){
        direction5 = 1;
      }
    

    };

    var render = () => {
      levelOne.style.left = offsetX1 + 'px';
      levelTwo.style.left = offsetX2 + 'px';
      levelThree.style.left = offsetX3 + 'px';
      levelFour.style.left = offsetX4 + 'px';
      levelFive.style.left = offsetX5 + 'px';           
    };

   // переопределить requestAnimationFrame, чтобы эмулировать различное количество FPS (одинаково во всех примерах игрового цикла)
    window.requestAnimationFrame = (func) => {
      clearTimeout(window.rafTimer);
      window.rafTimer = setTimeout(func, 1000 / (window.maxFPS || 60));
    };


    // game loop
    var last = performance.now(),
        step = 1 / 60, // обновление должно вызываться 60 раз в секунду
        dt = 0,
        now;

    var frame = () => {
      now = performance.now();
      dt += (now - last) / 1000;
      while(dt > step) {
        dt = dt - step;
        update(step);
      }
      last = now;

      render();
      requestAnimationFrame(frame); 
    }

      
      // requestAnimationFrame(frame); 
     
   
     function myStopFunction() {
     clearTimeout(window.rafTimer);
    }
     myStopFunction()

  
  }());
 
  
            
      
  </script>


</body>
</html>